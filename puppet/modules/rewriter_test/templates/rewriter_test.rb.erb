require 'open-uri'
require 'rubygems'
require 'minitest/autorun'
require 'json'


## test app

# ["REQUEST_PATH", "REQUEST_URI", "REQUEST_METHOD", "REQUEST_PATH", "PATH_INFO"]



LANGUAGES = %w(de en fr pl nl)
describe "testing" do

  def app_response(url)
    r = `curl -s '#{url}'`
    JSON.parse(r)
  end

  def check_request_uri(url)
    r = app_response(url)
    remove_port(r["REQUEST_URI"].gsub("http://", ''))
  end

  def remove_port(url)
    url.gsub(/\:9292/, '')
  end

  it "works" do
    (1+1).must_equal 2
  end

  describe "lang" do

    LANGUAGES.each do |lng|
      it "passes language #{lng} through" do
        check_request_uri("#{lng}.dawanda.com").must_equal "#{lng}.dawanda.com/"
      end
    end

  end
end
